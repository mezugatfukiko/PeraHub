{% extends 'base.html' %}
{% load static %}

{% block content %}
<header class="bg-white shadow p-4 flex justify-between items-center">
  <!-- Logo on the left -->
  <div class="flex items-center">
    <img src="{% static 'src/hb-logo.png' %}" alt="Logo" class="h-10 w-auto">
  </div>

  <!-- User info + dropdown -->
  <div x-data="{ open: false }" class="relative flex items-center text-gray-800 cursor-pointer">
    <!-- Profile Icon -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-12 w-12 text-purple-600 mr-3">
      <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" clip-rule="evenodd" />
    </svg>

    <!-- User Info -->
    <div class="text-right">
      <p class="font-bold text-gray-800">{{ user.get_full_name }}</p>
      <p class="text-sm text-gray-600">{{ user.email }}</p>
    </div>

    <!-- Dropdown Toggle -->
    <svg @click="open = !open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6 text-purple-600 ml-2 hover:text-purple-800 transition">
      <path fill-rule="evenodd" d="M12 14.25a.75.75 0 0 1-.53-.22l-4.5-4.5a.75.75 0 1 1 1.06-1.06L12 12.19l3.97-3.97a.75.75 0 1 1 1.06 1.06l-4.5 4.5a.75.75 0 0 1-.53.22Z" clip-rule="evenodd" />
    </svg>

    <!-- Dropdown Menu -->
    <div x-show="open" @click.outside="open = false" class="absolute top-full right-0 mt-2 w-35 bg-white shadow-lg rounded border z-50">
      <a href="{% url 'logout' %}" class="flex items-center px-4 py-2 text-black hover:bg-gray-100 transition">
        <!-- Logout Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5 mr-2">
          <path fill-rule="evenodd" d="M16.5 3.75a1.5 1.5 0 0 1 1.5 1.5v13.5a1.5 1.5 0 0 1-1.5 1.5h-6a1.5 1.5 0 0 1-1.5-1.5V15a.75.75 0 0 0-1.5 0v3.75a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3V5.25a3 3 0 0 0-3-3h-6a3 3 0 0 0-3 3V9A.75.75 0 1 0 9 9V5.25a1.5 1.5 0 0 1 1.5-1.5h6ZM5.78 8.47a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 0 0 0 1.06l3 3a.75.75 0 0 0 1.06-1.06l-1.72-1.72H15a.75.75 0 0 0 0-1.5H4.06l1.72-1.72a.75.75 0 0 0 0-1.06Z" clip-rule="evenodd" />
        </svg>
        Log out
      </a>
    </div>
  </div>
</header>

<!-- Main Dashboard Content -->
<div class="p-6 bg-gray-100 text-gray-800">
  <!-- Greeting + Cards in one row -->
  <div class="grid grid-cols-4 gap-4 items-center">
    <!-- Greeting in first column, centered -->
    <div class="flex justify-center items-center h-full text-center">
      <div>
        <h2 class="text-2xl font-semibold">Hello, {{ user.first_name }} ðŸ‘‹</h2>
        <p class="text-sm text-gray-600">Your finances at a glance.</p>
      </div>
    </div>

    <!-- Three cards with icons --><!-- Total Income Card -->
    <div class="bg-purple-100 p-4 rounded-lg shadow flex justify-between items-center">
      <div>
        <h4>Total Income</h4>
        <p class="text-2xl font-bold">â‚±{{ income|floatformat:2 }}</p>
      </div>
      <div class="text-purple-700">
        <!-- Income Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">
          <path d="M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z" />
          <path fill-rule="evenodd" d="M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H5.25a.75.75 0 0 1-.75-.75V9.75Z" clip-rule="evenodd" />
          <path d="M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z" />
        </svg>
      </div>
    </div>

    <!-- Total Expenses Card -->
    <div class="bg-purple-100 p-4 rounded-lg shadow flex justify-between items-center">
      <div>
        <h4>Total Expenses</h4>
        <p class="text-2xl font-bold">â‚±{{ expenses|floatformat:2 }}</p>
      </div>
      <div class="text-red-700">
        <!-- Expense Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">
          <path d="M4.5 3.75a3 3 0 0 0-3 3v.75h21v-.75a3 3 0 0 0-3-3h-15Z" />
          <path fill-rule="evenodd" d="M22.5 9.75h-21v7.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3v-7.5Zm-18 3.75a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" clip-rule="evenodd" />
        </svg>
      </div>
    </div>

    <!-- Remaining Balance Card -->
    <div class="bg-purple-100 p-4 rounded-lg shadow flex justify-between items-center">
      <div>
        <h4>Remaining Balance</h4>
        <p class="text-2xl font-bold">â‚±{{ balance|floatformat:2 }}</p>
      </div>
      <div class="text-green-700">
        <!-- Balance Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">
          <path d="M2.273 5.625A4.483 4.483 0 0 1 5.25 4.5h13.5c1.141 0 2.183.425 2.977 1.125A3 3 0 0 0 18.75 3H5.25a3 3 0 0 0-2.977 2.625ZM2.273 8.625A4.483 4.483 0 0 1 5.25 7.5h13.5c1.141 0 2.183.425 2.977 1.125A3 3 0 0 0 18.75 6H5.25a3 3 0 0 0-2.977 2.625ZM5.25 9a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h13.5a3 3 0 0 0 3-3v-6a3 3 0 0 0-3-3H15a.75.75 0 0 0-.75.75 2.25 2.25 0 0 1-4.5 0A.75.75 0 0 0 9 9H5.25Z" />
        </svg>
      </div>
    </div>
  </div>

  <!-- More dashboard content -->
  <div class="grid grid-cols-3 gap-4 mt-6">
    <div class="bg-purple-100 p-4 rounded-lg">
      <h4 class="font-semibold">Where Your Money Goes</h4>
      <ul class="mt-2 text-sm">
        {% for label, value in chart_data.items %}
          <li>{{ label }}: {{ value }}%</li>
        {% endfor %}
      </ul>
    </div>

    <div class="bg-purple-100 p-4 rounded-lg">
      <h4 class="font-semibold">Income vs Expenses</h4>
      <p class="text-sm text-gray-600 mt-4">[Chart Placeholder]</p>
    </div>

    <div class="bg-purple-100 p-4 rounded-lg">
      <h4 class="font-semibold">Add New Entry</h4>
      <form method="POST" class="mt-2">
        {% csrf_token %}
        <input type="text" name="title" placeholder="Title" class="block w-full mb-2 p-1 border rounded" />
        <input type="number" name="amount" placeholder="Amount" class="block w-full mb-2 p-1 border rounded" />
        <input type="date" name="date" class="block w-full mb-2 p-1 border rounded" />
        <select name="type" class="block w-full mb-2 p-1 border rounded">
          <option>Income</option>
          <option>Expense</option>
        </select>
        <textarea name="notes" placeholder="Notes (optional)" class="block w-full mb-2 p-1 border rounded"></textarea>
        <button type="submit" class="bg-green-500 text-white px-4 py-1 rounded">Add Entry</button>
      </form>
    </div>
  </div>

  <!-- Entries Table -->
  <div class="mt-8">
    <h4 class="text-xl font-semibold mb-2">Entries List</h4>
    <table class="w-full bg-white rounded shadow text-sm">
      <thead>
        <tr class="bg-purple-200 text-left">
          <th class="p-2">Title</th>
          <th>Amount</th>
          <th>Date</th>
          <th>Type</th>
          <th>Notes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in entries %}
        <tr class="border-t">
          <td class="p-2">{{ entry.title }}</td>
          <td>{{ entry.amount }}</td>
          <td>{{ entry.date }}</td>
          <td>{{ entry.type }}</td>
          <td>{{ entry.notes }}</td>
          <td>
            <a href="{% url 'edit_entry' entry.id %}" class="text-blue-500">Edit</a>
            <a href="{% url 'delete_entry' entry.id %}" class="text-red-500 ml-2">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center p-4">No entries yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
